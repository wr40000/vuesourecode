{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observe{\r\n    constructor(data){\r\n        // Object.defineProperty智能劫持已经存在的属性，vue2的$set就是为后加的属性添加响应式\r\n        this.walk(data)        \r\n    }\r\n    walk(data){\r\n        // 重新定义属性  性能不太行\r\n        Object.keys(data).forEach(key => defineReactive(data,key,data[key]))\r\n    }\r\n}\r\n\r\nexport function defineReactive(target, key, value) {\r\n    observe(value);\r\n    Object.defineProperties(target, {\r\n        [key]: {\r\n            get() {\r\n                console.log(\"用户取值了\");\r\n                return value;\r\n            },\r\n            set(newValue) {\r\n                console.log(\"用户更改值了\");\r\n                if (value === newValue) return;\r\n                value = newValue;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nexport function observe(data){    \r\n    if(typeof data !== 'object' || data == null){\r\n        return;     // 只对对象数据劫持\r\n    }\r\n\r\n    // 被劫持过则不需要在劫持(判断是否被劫持,可以增添一个实例，用实例来判断是否被劫持过)\r\n    return new Observe(data)\r\n}","import { observe } from \"./observe/index\";\r\n\r\nexport default function initState(vm){\r\n    const opts = vm.$options;\r\n    if(opts.data){\r\n        initData(vm);\r\n    }\r\n}\r\n// vm._data 用vm 代理 使得读取vm._data.name可以简化为vm.name\r\nfunction proxy(vm, target, key){\r\n    Object.defineProperties(vm,{\r\n        [key]:\r\n        {\r\n            get(){\r\n                return vm[target][key]\r\n            },\r\n            set(newvalue){                \r\n                if(vm[target][key] === newvalue) return\r\n                vm[target][key] = newvalue\r\n            }\r\n        }\r\n    })\r\n}\r\nfunction initData(vm){\r\n    let data = vm.$options.data\r\n    data = typeof data === 'function' ? data.call(vm) : data;\r\n    vm._data = data;\r\n    // console.log(vm._data === data); // true\r\n    // 数据劫持\r\n    observe(data)   //Object.defineProperties重新递归定义递归\r\n\r\n    // vm._data 用vm 代理 使得读取vm._data.name可以简化为vm.name\r\n    for(let key in data){\r\n        proxy(vm, \"_data\", key)\r\n    }\r\n}","import initState from \"./state\";\r\n\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options){\r\n        const vm = this;\r\n        vm.$options = options;    // 用户数据挂载到实例上\r\n\r\n        // 初始状态\r\n        initState(vm);\r\n    }\r\n}\r\n\r\n","import {initMixin} from './init'\r\n\r\nfunction Vue(options){\r\n    this._init(options)\r\n};\r\n\r\ninitMixin(Vue)\r\n\r\n\r\n\r\nexport default Vue;"],"names":["Observe","data","_classCallCheck","walk","_createClass","key","value","Object","keys","forEach","defineReactive","target","observe","defineProperties","_defineProperty","get","console","log","set","newValue","_typeof","initState","vm","opts","$options","initData","proxy","newvalue","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}